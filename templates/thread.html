{% extends "base.html" %}
{% block head %}
 <link rel="stylesheet" type="text/css" href= "{{ url_for('static', filename='trix.css') }}" >
 <script type= "text/javascript" src="{{ url_for('static', filename='trix.js') }}"></script>
 <script>
	function answ(nick) {
		document.getElementById('comment').value = '@' + nick + ', ';
		window.scrollTo(0, 0);
	}
 </script>
{% endblock %}
{% block content %}
	<a href="{{ url_for('sect', section_id=section_id) }}"><i class="fa fa-long-arrow-left fa-3x" aria-hidden="true"></i></a>
	<div class="thread thr">
		<div class="lft_thr">
			<h3>{{ thread.name }}</h3>
			<hr></hr>
			<p>{{ thread.description }}</p>
		</div>
		<div class="rght_thr">
			<img src="{{ url_for('static', filename='images/avatar.png') }}">
			<p><a href="{{ url_for('user', user_id=thread.author_id) }}">{{ thread.author.nickname }}</a></p>
		</div>
	</div>
	{% if current_user.id == thread.author.id %}
		<pre><a class="del_tred" href="{{ url_for('delete_thread', thread_id=thread.id) }}"><i class="fa fa-trash-o" aria-hidden="true"></i>  Удалить тред</a></pre>
	{% endif %}
	<form action="" method="post" class="mes">
		{{ form.hidden_tag() }}
		{{ form.csrf_token }}
		<p class="add_mes">
			{{ form.content.label }}<br>
			{{ form.content(class="form-control mes_content", id="x", style="display: none") }}<br>
			<trix-editor input="x" class="editor" rows="10" id="comment"></trix-editor><br>
			{% for error in form.content.errors %}
				<p class="alert alert-danger" role="alert">
					{{ error }}
				</p>
			{% endfor %}
		</p>
		<p>{{ form.submit(type="submit", class="btn btn-primary") }}</p>
		<p class="message">{{message}}</p>
	</form>
	{% if messages %}
		{% for message in messages %}
			<div class="mess">
				<div class="lft_mes">
					<p class="info_mes">{{ message.created_date.strftime("%Y-%m-%d %H:%M") }}</p>
					<p>{{ message.content | safe}}</p>
				</div>
				<div class="rght_mes">
					<img src="{{ url_for('static', filename='images/avatar.png') }}">
					<p><a href="{{ url_for('user', user_id=message.author_id) }}">{{ message.author.nickname }}</a></p>
				</div>
			</div>
			{% if message.author_id == current_user.id %}
				<a class="btn_mes" href="{{ url_for('delete_message', thread_id=message.thread_id, section_id=section_id, message_id=message.id) }}"><i class="fa fa-trash-o" aria-hidden="true"></i></a>
			{% else %}
				<a class="btn_mes answer" onclick="answ('{{ message.author.nickname }}')">Ответить</a>
			{% endif %}
		{% endfor %}
	{% else %}
		<h4 style="margin-left: 4%">Сообщений пока нет</h4>
	{% endif %}
{% endblock %}